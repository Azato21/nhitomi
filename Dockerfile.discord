FROM node:lts-alpine as discord
WORKDIR /app

COPY nhitomi-discord/package*.json ./
COPY scripts ../scripts/
RUN yarn

# java 8 required by openapi-generator
RUN apk add --no-cache openjdk8-jre
RUN yarn genclient

COPY nhitomi-discord ./
RUN yarn build

WORKDIR /app/build
ENV NODE_ENV production
ENTRYPOINT ["node", "index.js"]
